# 航空公司客戶價值分析
  [航空公司客戶價值分析-筆記](https://hackmd.io/s/BJfBU-kUN)

* **目標:**

    (1) 利用航空公司客戶數據，對客戶進行分類。
    
    (2) 針對不同的客戶類型進行特徵分析，比較不同類型客戶的價值。
    
    (3) 客戶流失分析。

* **分析方法與過程**
    分析客戶價值最常使用的模型是RFM模型，他透過三個指標(最近消費時間間隔(Recency)、消費頻率(Frequency)、和消費金額(Monetary))，來分析客戶的價值。
    
    RFM模型意義:
    
    1、最近有過交易行為的客戶，再次發生交易的可能性要高於最近沒有交易行為的客戶。
    
    2.交易頻率較高的客戶比交易頻率較低的客戶，更有可能再次發生交易行為。
    
    3.過去所有交易總金額較多的客戶，比交易總金額較少的客戶，更有消費積極性。
    
    接下來根據RFM模型來進行特徵選擇，因為飛機票價取決於飛行距離和艙位等級，消費相同金額票價的旅客對航空公司的價值不一定相同，購買短程頭等艙的旅客和購買長途經濟艙的旅客，前者對航空公司的價值可能更高。所以對 "消費金額" 建模時要進行修改，用 "里程數平均值" 和 "艙位折扣係數平均值"，來代替消費的金額。
    同時，考慮旅客中，加入會員的時間越長，客戶的潛在價值一般越高，所以定義一個 "客戶關係長度",作爲區分客戶的另一指標。因此最後使用了，客戶關係長度、消費時間間隔、消費頻率、飛行里程、折扣係數平均值，這五個特徵，作為分析客戶價值的指標。
    

  | 客戶關係長度 | 消費時間間隔 | 消費頻率 | 飛行里程 | 折扣係數平均值 |
  | -------- | -------- | -------- | -------- | -------- |
  | 會員入會時間到觀測結束的月數 | 客戶最近一次搭乘公司飛機距觀測結束的月數 | 客戶在觀測時間內搭乘公司飛機的次數 | 客戶在觀測時間內累計的飛行里程 | 客戶在觀測時間內乘坐艙位所對應的折扣係數平均 |


  傳統RFM模型分析的屬性分箱法，是依據屬性的平均值進行劃分，所以單個指標的比較只會有兩種情況，大於(等於)或小於平均值，因此RFM模型可能有2X2X2=8種類別，(其中大於平均值的表示為↑，小於平均值的表示為 ↓)。雖然可以找出最有價值的客戶，但是區分的客戶群太多了，會提高針對性行銷的成本，因此我採用K-Means的方法，並將客戶區分為五類。
  ![](https://i.imgur.com/X6pEPOH.jpg)


* **數據探索**
    執行data_explore.py可得到以下結果

	|特徵名稱| 空值数 | 最大值 | 最小值 |
    |------|-------|------|------|
    |MEMBER_NO |0|62988	|1|
    |FFP_DATE	|0	||
    |FIRST_FLIGHT_DATE|	0 ||	
    |GENDER	|3		||
    |FFP_TIER|	0|	6|	4|
    |WORK_CITY	|2269|||		
    |WORK_PROVINCE|	3248||		
    |WORK_COUNTRY|	26	||	
    |AGE	|420	| 110| 6|
    |LOAD_TIME	|0	|||	
    |FLIGHT_COUNT	0	|213| 2|
    |BP_SUM|	0|	505308|	0|
    |EP_SUM_YR_1|	0|	0	|0|
    |EP_SUM_YR_2|	0	|74460	|0|
    |SUM_YR_1|	551|	239560|	0|
    |SUM_YR_2|	138|	234188|	0|
    |SEG_KM_SUM	|0	|580717|	368|
    |WEIGHTED_SEG_KM|	0|	558440.14|0|
    |LAST_FLIGHT_DATE|	0	|||	
    |AVG_FLIGHT_COUNT|	0	|26.625|0.25|
    |AVG_BP_SUM|	0|	63163.5|	0|
    |BEGIN_TO_FIRST|	0|	729|	0|
    |LAST_TO_END|	0|	731|	1|
    |AVG_INTERVAL|	0|	728|	0|
    |MAX_INTERVAL|	0|	728|	0|
    |ADD_POINTS_SUM_YR_1|	0|	600000|	0|
    |ADD_POINTS_SUM_YR_2|	0|	728282|	0|
    |EXCHANGE_COUNT	|0	|46|	0|
    |avg_discount	|0	|1.5|	0|
    |P1Y_Flight_Count	|0|	118|	0|
    |L1Y_Flight_Count	|0	|111|	0|
    |P1Y_BP_SUM	|0	|246197	|0|
    |L1Y_BP_SUM	|0	|259111	|0|
    |EP_SUM	|0	|74460	|0|
    |ADD_Point_SUM	|0	|984938	|0|
    |Eli_Add_Point_Sum	|0	|984938	|0|
    |L1Y_ELi_Add_Points	|0	|728282	|0|
    |Points_Sum	|0	|985572	|0|
    |L1Y_Points_Sum	|0	|728282	|0|
    |Ration_L1Y_Flight_Count|0	|1	|0|
    |Ration_P1Y_Flight_Count|0	|1	|0|
    |Ration_P1Y_BPS	|0	|0.99998861	|0|
    |Ration_L1Y_BPS	|0	|0.999993205|0|
    |Point_NotFlight|0	|140	|0|
    

* **數據清洗 (data_clean_1.py)**
    - Missing value處理:
    
    由於原始數據量大，這類數據佔的比例較小，對問題影響不大，因此刪除。
    
      (1)刪除第一、二年票價為NULL的紀錄。

      (2)刪除票價為0、平均折扣率不為0、總飛行公里數大於0的紀錄。
    
    - 特徵處理:
    
    使用我們根據RFM模型選擇與修改後的五個特徵
    
      (1) 客戶關係長度 = (LOAD_TIME - FFP_DATE) / 30

      (2) 消費時間間隔	= LAST_TO_END / 30

      (3) 消費頻率 = FLIGHT_COUNT

      (4) 飛行里程 = SEG_KM_SUM

      (5) 折扣係數平均值 = avg_discount
    

       |特徵名稱|客戶關係長度|消費時間間隔|消費頻率|飛行里程|折扣係數平均值|
       |---|---|---|---|---|---|
       |最大值| 12| 0.03| 2| 368| 0.136|
       |最小值|114|24.37|213|580717|1.5|

       因為這五個特徵的數值範圍、單位都不同，所以需要進行標準化，消除此影響。
    
* **模型建立**

    使用K-Means將客戶分為五類。
    
    [K-Means Clustering 筆記](https://hackmd.io/s/BJ0YbDAD4)
    
* **客戶價值分析**

![](https://i.imgur.com/LxOxhbW.jpg)
![](https://i.imgur.com/7OMFqUp.jpg)
![](https://i.imgur.com/EA4CtM7.jpg)

    - 重要保持客戶：平均折扣率較高，消費時間間隔低，搭乘次數高，公里數高。此類客戶對航空公司的價值最大，同時所佔比例也最低，應優先把資源投放到他們身上，進一步提升客戶滿意度。

    - 重要發展客戶：平均折扣率較高，消費時間間隔低，但是搭乘次數低或公里數低。此類客戶的入會時間短，他們是潛在用戶，有很大的發展潛力，應進一步促進其消費。

    - 重要挽留客戶：平均折扣率較高、搭乘次數高或公里數高，入會時間長，但是消費時間間隔高。此類客戶的客戶價值變化的不確定性很高，應對此類客戶重點聯繫，常用一點營銷手段延長客戶生命周期。

    - 一般與低價值客戶：平均折扣率低，消費時間間隔高，搭乘次數低或公里數低，入會時間短。此類客戶是低價值客戶，可能是機票打折時才會購買航班。

    - 客戶價值排名
    
        |排名|客戶群|排名意義|
        |---|---|---|
        |1 |2 |重要保持客戶|
        |2 |3 |重要發展客戶|
        |3 |4 |重要挽留客戶|
        |4 |1 |一般客戶|
        |5 |0 |低價值客戶|

* **客戶流失分析**

  預測未來客戶的狀況(已流失、準流失、未流失)

   - 定義客戶類型:
    
     (1) 已流失客戶:第二年飛行次數與第一年飛行次數比例小於50%的客戶。

     (2) 準流失客戶:第二年飛行次數與第一年飛行次數比例在[50%,90%)內的客戶。

     (3) 未流失客戶:第二年飛行次數與第一年飛行次數比例大於90%的客戶。
    
   - 特徵選擇與處理:
    
      data_clean_2.py
      
   - 模型建立:
    
        [Logistic Regression 筆記](https://hackmd.io/s/By3gDwAwE)
        
        (將數據70%作為訓練樣本，30%作為測試樣本)




